<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.scau.mapper.UserMapper">
    <insert id="createTable1">
        create table `t_${userId}_cart`
        (
            `book_id`          int(11) NOT NULL AUTO_INCREMENT COMMENT '图书表唯一标识',
            `book_number`      bigint(11) NOT NULL COMMENT '图书编号 图书的唯一标识',
            `book_name`        varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci  NOT NULL COMMENT '图书名称',
            `book_author`      varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci  NOT NULL COMMENT '图书作者',
            `book_type`        varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci  NOT NULL COMMENT '图书类别',
            `book_description` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT '图书描述',
            `create_time`      datetime                                                NOT NULL COMMENT '创建时间',
            `update_time`      datetime                                                NOT NULL COMMENT '更新时间',
            PRIMARY KEY (`book_id`) USING BTREE
        ) ENGINE = InnoDB AUTO_INCREMENT = 99 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = DYNAMIC;

    </insert>
    <insert id="createTable2">
        create table `t_${userId}_collection`
        (
            `book_id`          int(11) NOT NULL AUTO_INCREMENT COMMENT '图书表唯一标识',
            `book_number`      bigint(11) NOT NULL COMMENT '图书编号 图书的唯一标识',
            `book_name`        varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci  NOT NULL COMMENT '图书名称',
            `book_author`      varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci  NOT NULL COMMENT '图书作者',
            `book_type`        varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci  NOT NULL COMMENT '图书类别',
            `book_description` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT '图书描述',
            `create_time`      datetime                                                NOT NULL COMMENT '创建时间',
            `update_time`      datetime                                                NOT NULL COMMENT '更新时间',
            PRIMARY KEY (`book_id`) USING BTREE
        ) ENGINE = InnoDB AUTO_INCREMENT = 99 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = DYNAMIC;

    </insert>

    <insert id="insertData1">
        insert into t_${userId}_cart (book_id,book_number, book_name,book_author,book_type,book_description,create_time,update_time)
        values (#{bookId},#{bookNumber}, #{bookName},#{bookAuthor},#{bookType},#{bookDescription},#{createTime},#{updateTime})
    </insert>
    <insert id="insertData2">
        insert into t_${userId}_collection (book_id,book_number, book_name,book_author,book_type,book_description,create_time,update_time)
        values (#{bookId},#{bookNumber}, #{bookName},#{bookAuthor},#{bookType},#{bookDescription},#{createTime},#{updateTime})
    </insert>


    <select id="pageQuery" resultType="com.scau.entity.Books">
        select * from t_books
        <where>
            <if test="book_name != null">
                and book_name like concat('%',
                #{query},
                '%'
                )
            </if>

            <if test="book_number != null">
                and book_number like concat('%',
                #{query},
                '%'
                )
            </if>

            <if test="book_type != null">
                and book_type like concat('%',
                #{query},
                '%'
                )
            </if>

            <if test="book_author != null">
                and book_author like concat('%',
                #{query},
                '%'
                )
            </if>


        </where>
        order by book_id asc
    </select>

    <select id="checkTableExists1" resultType="java.lang.Integer">
        select count(*)
        from information_schema.tables
        where table_name = 't_${userId}_cart'
    </select>

    <select id="checkTableExists2" resultType="java.lang.Integer">
        select count(*)
        from information_schema.tables
        where table_name = 't_${userId}_collection'
    </select>

    <select id="checkBookExists1" resultType="java.lang.Integer">
        select count(*)
        from t_${userId}_cart
        where book_number = #{bookNumber}
          and book_name = #{bookName}
    </select>
    <select id="checkBookExists2" resultType="java.lang.Integer">
        select count(*)
        from t_${userId}_collection
        where book_number = #{bookNumber}
          and book_name = #{bookName}
    </select>



    <select id="cateGet" resultType="com.scau.entity.CartBooks">
        select *
        from t_books
        where book_number = #{bookNumber}
    </select>
    <select id="collectionGet" resultType="com.scau.entity.CollectionBooks">
        select *
        from t_books
        where book_number = #{bookNumber}
    </select>

    <select id="cartQuery" resultType="com.scau.entity.CartBooks">
        select * from t_${userId}_cart order by book_id asc
    </select>
    <select id="collectionQuery" resultType="com.scau.entity.CollectionBooks">
        select * from t_${userId}_collection order by book_id asc
    </select>
</mapper>
